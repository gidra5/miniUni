import "std/iter" as { range }

content := string import "./test.txt"
matrix := content.split("\n").filter(line -> length line).map(line -> line.split("").filter(char -> char != "\r"))
sum := 0

col_height := length matrix

for columnIndex in range 0 (length (matrix[0])) {
  handle := -1
  count := 0

  for rowIndex in range 0 col_height {
    char := matrix[rowIndex][columnIndex]
    
    if char == "#" {
      load := col_height - handle - (1 + count)/2
      sum += count * load
      count = 0
      handle = rowIndex
    }

    if char == "O": count++
  }

  load := col_height - handle - (1 + count)/2
  sum += count * load
}

sum